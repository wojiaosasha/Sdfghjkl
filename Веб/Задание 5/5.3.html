<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>5.3</title>
    <style>
      body {
        font-family: sans-serif;
      }

      span {
        cursor: pointer;
      }

      span:hover {
        color: rgb(253, 7, 7);
      }

      .li-count {
        color: #ccc;
        cursor: default;
      }

      .li-count:hover {
        color: #ccc;
      }
    </style>
    <script>
      function smth() {
        var animals = [
          {
            name: "Животные",
            children: [
              {
                name: "Млекопитающие",
                children: [
                  {
                    name: "Коровы",
                    children: [],
                  },
                  {
                    name: "Ослы",
                    children: [],
                  },
                  {
                    name: "Собаки",
                    children: [],
                  },
                  {
                    name: "Тигры",
                    children: [],
                  },
                ],
              },
              {
                name: "Другие",
                children: [
                  {
                    name: "Змеи",
                    children: [],
                  },
                  {
                    name: "Птицы",
                    children: [],
                  },
                  {
                    name: "Ящирицы",
                    children: [],
                  },
                ],
              },
            ],
          },
          {
            name: "Рыбы",
            children: [
              {
                name: "Аквариумные",
                children: [
                  {
                    name: "Гуппи",
                    children: [],
                  },
                  {
                    name: "Скалярии",
                    children: [],
                  },
                ],
              },
              {
                name: "Морские",
                children: [
                  {
                    name: "Морская форель",
                    children: [],
                  },
                ],
              },
            ],
          },
        ];

        function generate(item, par) {
          if (item.length > 0) {
            par.append("<ul></ul>");
            for (var i = 0; i < item.length; i++) {
              par
                .children("ul")
                .append("<li><span>" + item[i].name + "</span></li>");
              generate(
                item[i].children,
                par.children("ul").children("li:last-child")
              );
            }
          }
        }
        generate(animals, $("#workspace"));

        $("li").each(function (k) {
          console.log(
            'Элемент "' +
              $(this).children("span").text() +
              '" имеет ' +
              $(this).find("li").length +
              " вложенных LI"
          );
          $(this)
            .children("span")
            .after('<span class=li-count id="counter' + k + '"></span>');
          $("#counter" + k).html(
            $(this).find("li").length != 0
              ? " [" + $(this).find("li").length + " вложенных LI]"
              : ""
          );
        });

        $("LI").click(function () {
          $(this).children().not("span").slideToggle();
          event.stopPropagation();
        });
      }
    </script>
  </head>

  <body>
    <section id="workspace"></section>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script>
      smth();
    </script>
  </body>
</html>
